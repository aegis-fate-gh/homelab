version: '3.8'

services:
  prowlarr:
    image: ghcr.io/hotio/prowlarr
    environment:
      - PUID=1000
      - PGID=999
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - '/mnt/ceph/prowlarr_data:/config'
    ports:
      - 9696:9696
    networks:
      - media
      - local_proxy
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: 
          - "node.role == worker"
          - "node.labels.connection == vpn"
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.prowlarr-rtr.entrypoints=web"
        - "traefik.http.routers.prowlarr-rtr.rule=Host(`prowlarr.local.sch-apps.com`)"
        - "traefik.http.routers.prowlarr-rtr.service=prowlarr-svc"
        - "traefik.http.services.prowlarr-svc.loadbalancer.server.port=9696"
        - shepherd.updates=true
        - homepage.group=Media Acquisition
        - homepage.name=Prowlarr
        - homepage.icon=prowlarr.png
        - homepage.href=http://prowlarr.local.sch-apps.com
        - homepage.description=Indexer Management
        - homepage.widget.type=prowlarr
        - homepage.widget.target=_blank
        - homepage.widget.url=http://prowlarr.local.sch-apps.com
        - homepage.widget.key=3978745a0b7b4009bf63a40486a1615c

  bazarr:
    image: ghcr.io/hotio/bazarr
    environment:
      - PUID=1000
      - PGID=999
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - '/mnt/ceph/bazarr_data:/config'
      - '/mnt/samba/media:/media'
    ports:
      - 6767:6767
    networks:
      - media
      - local_proxy
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: 
          - "node.role == worker"
          - "node.labels.connection == vpn"
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.bazarr-rtr.entrypoints=web"
        - "traefik.http.routers.bazarr-rtr.rule=Host(`bazarr.local.sch-apps.com`)"
        - "traefik.http.routers.bazarr-rtr.service=bazarr-svc"
        - "traefik.http.services.bazarr-svc.loadbalancer.server.port=6767"
        - shepherd.updates=true
        - homepage.group=Media Acquisition
        - homepage.name=Bazarr
        - homepage.icon=bazarr.png
        - homepage.href=http://bazarr.local.sch-apps.com
        - homepage.description=Subtitle Acquisition
        - homepage.widget.type=bazarr
        - homepage.widget.target=_blank
        - homepage.widget.url=http://bazarr.local.sch-apps.com
        - homepage.widget.key=845515585f029aa30d8ff949fff0182a

  sonarr:
    image: ghcr.io/hotio/sonarr
    environment:
      - PUID=1000
      - PGID=999
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - '/mnt/ceph/sonarr_data:/config'
      - '/mnt/samba/media:/media'
    ports:
      - 8989:8989
    networks:
      - media
      - local_proxy
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: 
          - "node.role == worker"
          - "node.labels.connection == vpn"
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.sonarr-rtr.entrypoints=web"
        - "traefik.http.routers.sonarr-rtr.rule=Host(`sonarr.local.sch-apps.com`)"
        - "traefik.http.routers.sonarr-rtr.service=sonarr-svc"
        - "traefik.http.services.sonarr-svc.loadbalancer.server.port=8989"
        - shepherd.updates=true
        - homepage.group=Media Acquisition
        - homepage.name=Sonarr
        - homepage.icon=sonarr.png
        - homepage.href=http://sonarr.local.sch-apps.com
        - homepage.description=Show Acquisition
        - homepage.widget.type=sonarr
        - homepage.widget.target=_blank
        - homepage.widget.url=http://sonarr.local.sch-apps.com
        - homepage.widget.key=f979c4c17c0c48ccac97ad8f4fcdf36a

  radarr:
    image: ghcr.io/hotio/radarr
    environment:
      - PUID=1000
      - PGID=999
      - UMASK=002
      - TZ=America/Chicago
    volumes:
      - '/mnt/ceph/radarr_data:/config'
      - '/mnt/samba/media:/media'
    ports:
      - 7878:7878
    networks:
      - media
      - local_proxy
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: 
          - "node.role == worker"
          - "node.labels.connection == vpn"
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.radarr-rtr.entrypoints=web"
        - "traefik.http.routers.radarr-rtr.rule=Host(`radarr.local.sch-apps.com`)"
        - "traefik.http.routers.radarr-rtr.service=radarr-svc"
        - "traefik.http.services.radarr-svc.loadbalancer.server.port=7878"
        - shepherd.updates=true
        - homepage.group=Media Acquisition
        - homepage.name=radarr
        - homepage.icon=radarr.png
        - homepage.href=http://radarr.local.sch-apps.com
        - homepage.description=Movie Acquisition
        - homepage.widget.type=radarr
        - homepage.widget.target=_blank
        - homepage.widget.url=http://radarr.local.sch-apps.com
        - homepage.widget.key=139cff2c5dc946b6ae4e9d9c74cc9408

volumes:
  prowlarr_data:
    driver: local
  bazarr_data:
    driver: local
  sonarr_data:
    driver: local
  radarr_data:
    driver: local

networks:
  local_proxy:
    external: true
  media:
    name: media
    driver: overlay
    attachable: true
